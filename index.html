<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OpenStreetMap ‚Äì Leaflet Starter</title>

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <style>
      /* Vollbild-Karte */
      html, body { height: 100%; margin: 0; }
      #map { height: 100%; width: 100%; }
      .toolbar {
        position: absolute; z-index: 1000; left: 10px; bottom: 10px;
        background: white; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,.15);
        padding: 8px; display: flex; gap: 8px; align-items: center;
      }
      .toolbar button {
        border: 0; border-radius: 8px; padding: 8px 10px; cursor: pointer;
        background: #2b7cff; color: white; font-weight: 600;
      }
      .toolbar input {
        border: 1px solid #ddd; border-radius: 8px; padding: 8px 10px; min-width: 220px;
      }
      .credit { position:absolute; z-index: 1000; right:10px; bottom:10px; background:rgba(255,255,255,.9); padding:6px 10px; border-radius: 10px; font: 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div class="toolbar">
  <button id="locate">üìç Standort</button>
  <input id="search" type="text" placeholder="Ort suchen (z.B. Stephansdom)" />
  <button id="go">Suche</button>
  <input id="geojson-upload" type="file" accept="application/geo+json,application/json" style="min-width:unset;" />
    </div>
    <div class="credit">Karten-Daten ¬© <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noreferrer">OpenStreetMap</a>-Mitwirkende</div>

    <!-- Leaflet JS -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    ></script>

    <script>
      // Ausgangsposition: Wien (kannst du beliebig √§ndern)
      const START_COORDS = [48.2082, 16.3738];
      const START_ZOOM = 13;

      // Karte initialisieren
      const map = L.map('map').setView(START_COORDS, START_ZOOM);

      // OSM-Kachel-Layer hinzuf√ºgen (mit Attribution)

      const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>-Mitwirkende'
      }).addTo(map);


      // Beispiel-Marker in Wien
      const marker = L.marker(START_COORDS).addTo(map);
      marker.bindPopup('<b>Wien</b><br>Willkommen auf deiner OSM-Karte.');

      // "Standort"-Button: Browser-Geolokalisierung
      const locateBtn = document.getElementById('locate');
      locateBtn.addEventListener('click', () => {
        if (!navigator.geolocation) {
          alert('Geolokalisierung wird von deinem Browser nicht unterst√ºtzt.');
          return;
        }
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const { latitude, longitude } = pos.coords;
            const here = [latitude, longitude];
            map.setView(here, 15);
            L.marker(here).addTo(map).bindPopup('Du bist hier.').openPopup();
          },
          (err) => {
            console.error(err);
            alert('Konnte Standort nicht bestimmen. Erlaube Zugriff oder versuche es sp√§ter erneut.');
          },
          { enableHighAccuracy: true, timeout: 8000, maximumAge: 0 }
        );
      });

      // Mini-Suche mit Nominatim (ohne API-Key). Hinweis: Bitte sparsam nutzen.
      const searchInput = document.getElementById('search');
      const goBtn = document.getElementById('go');

      async function geocode(q) {
        const url = new URL('https://nominatim.openstreetmap.org/search');
        url.searchParams.set('q', q);
        url.searchParams.set('format', 'json');
        url.searchParams.set('addressdetails', '0');
        url.searchParams.set('limit', '1');
        // Setze User-Agent / Referer implizit durch den Browser. Behandle Rate-Limits respektvoll.
        const res = await fetch(url, { headers: { 'Accept-Language': 'de' } });
        if (!res.ok) throw new Error('Suche fehlgeschlagen: ' + res.status);
        const data = await res.json();
        return data[0];
      }

      async function handleSearch() {
        const q = searchInput.value.trim();
        if (!q) return;
        try {
          const r = await geocode(q);
          if (!r) { alert('Kein Ergebnis gefunden.'); return; }
          const lat = parseFloat(r.lat), lon = parseFloat(r.lon);
          map.setView([lat, lon], 15);
          L.circleMarker([lat, lon], { radius: 8 }).addTo(map).bindPopup(r.display_name).openPopup();
        } catch (e) {
          console.error(e);
          alert('Fehler bei der Suche. Bitte sp√§ter erneut versuchen.');
        }
      }

      goBtn.addEventListener('click', handleSearch);
      searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') handleSearch(); });

      // Tastatur-Shortcuts: + / - f√ºr Zoom
      document.addEventListener('keydown', (e) => {
        if (e.key === '+') map.zoomIn();
        if (e.key === '-') map.zoomOut();
      });

      // GeoJSON-Upload und Anzeige
const geojsonUpload = document.getElementById('geojson-upload');
geojsonUpload.addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(evt) {
    try {
      const geojson = JSON.parse(evt.target.result);
      const layer = L.geoJSON(geojson, {
        style: function(feature) {
          if (feature.properties && feature.properties.typ === 'Wohngebiet') {
            return { color: 'blue', fillColor: 'blue', fillOpacity: 0.5 };
          }
          if (feature.properties && feature.properties.typ === 'Parkgebiet') {
            return { color: 'green', fillColor: 'green', fillOpacity: 0.5 };
          }
          return { color: 'gray', fillOpacity: 0.3 };
        },
        onEachFeature: function (feature, layer) {
          if (feature.properties && feature.properties.name) {
            layer.bindPopup(feature.properties.name);
          }
        }
      }).addTo(map);
      map.fitBounds(layer.getBounds());
    } catch (err) {
      alert('Ung√ºltige GeoJSON-Datei!');
    }
  };
  reader.readAsText(file);
});
    </script>
  </body>
</html>
